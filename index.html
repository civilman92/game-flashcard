<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒœå­—éŠæˆ² - è‡ªè¨‚èˆ‡éš¨æ©Ÿå‡ºé¡Œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f4f9;
        }
        .container {
            width: 90%;
            max-width: 600px;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        /* é¦–é /è¨­å®šé é¢ */
        #settings-screen {
            display: block;
        }
        #game-screen {
            display: none;
        }
        .setting-section {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        .btn {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        /* éŠæˆ²ç•«é¢ */
        #question-display {
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        #answer-input {
            width: 100%;
            padding: 10px;
            font-size: 1.5em;
            text-align: center;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        #message {
            min-height: 30px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .correct {
            color: green;
        }
        .incorrect {
            color: red;
        }
        #score-board {
            text-align: center;
            margin-top: 10px;
            font-size: 1.1em;
            color: #666;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>çŒœå­—éŠæˆ²</h1>

        <div id="settings-screen">
            <h2>å‡ºé¡Œè¨­å®š</h2>
            
            <div class="setting-section">
                <label for="backend-group">é¸æ“‡å¾Œå°é¡Œçµ„ (ç¯„ä¾‹)</label>
                <select id="backend-group">
                    <option value="group1">è‹±æ–‡åŸºç¤å–®å­—</option>
                    <option value="group2">åŸå¸‚åç¨±</option>
                </select>
            </div>
            
            <div class="setting-section">
                <label for="custom-questions">æ‰‹å‹•è¼¸å…¥è€ƒé¡Œ (æ ¼å¼: å–®å­—/æç¤ºï¼Œæ¯è¡Œä¸€çµ„)</label>
                <textarea id="custom-questions" placeholder="ä¾‹å¦‚: APPLE/æ°´æœ&#10;BANANA/é»ƒè‰²çš„"></textarea>
                <small>è«‹æ³¨æ„æ ¼å¼ï¼šå–®å­—å¾Œæ¥æ–œç·š / å†æ¥æç¤ºï¼Œæ¯è¡Œä¸€å€‹ã€‚</small>
            </div>
            
            <button class="btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
        </div>

        <div id="game-screen">
            <div id="question-display"></div>
            <input type="text" id="answer-input" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ" maxlength="15">
            <button class="btn" id="submit-btn" onclick="checkAnswer()">å®Œæˆ (Enter)</button>
            <div id="message"></div>
            <div id="score-board"></div>
            <button class="btn" onclick="resetGame()" style="background-color: #6c757d;">å›è¨­å®šé </button>
        </div>
    </div>

    <script>
        // å¾Œå°æ¨¡æ“¬é¡Œåº« (å¯¦éš›æ‡‰ç”¨ä¸­æ‡‰å¾ä¼ºæœå™¨å–å¾—)
        const BACKEND_QUESTIONS = {
            group1: [
                { word: "CAT", hint: "ä¸€ç¨®å¯µç‰©" },
                { word: "DOG", hint: "æ±ªæ±ªå«çš„å‹•ç‰©" },
                { word: "HOUSE", hint: "ä½çš„åœ°æ–¹" }
            ],
            group2: [
                { word: "TAIPEI", hint: "å°ç£çš„é¦–éƒ½" },
                { word: "TOKYO", hint: "æ—¥æœ¬çš„é¦–éƒ½" },
                { word: "SEOUL", hint: "éŸ“åœ‹çš„é¦–éƒ½" }
            ]
        };

        let currentQuestionList = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswerChecked = false; // ç”¨æ–¼æ§åˆ¶ Enter éµçš„ç‹€æ…‹

        // --- å•Ÿå‹•éŠæˆ²é‚è¼¯ ---
        function startGame() {
            const selectedGroup = document.getElementById('backend-group').value;
            const customQuestionsText = document.getElementById('custom-questions').value;

            // 1. åˆä½µå¾Œå°é¸å–é¡Œçµ„
            let combinedQuestions = [...BACKEND_QUESTIONS[selectedGroup]];

            // 2. åˆä½µæ‰‹å‹•è¼¸å…¥è€ƒé¡Œ
            const customQuestions = parseCustomQuestions(customQuestionsText);
            combinedQuestions = combinedQuestions.concat(customQuestions);

            if (combinedQuestions.length === 0) {
                alert("è«‹è‡³å°‘è¼¸å…¥ä¸€çµ„é¡Œç›®æˆ–é¸æ“‡ä¸€å€‹é¡Œçµ„ï¼");
                return;
            }

            // 3. éš¨æ©Ÿæ’åº
            currentQuestionList = shuffleArray(combinedQuestions);

            // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
            currentQuestionIndex = 0;
            score = 0;
            isAnswerChecked = false;

            // åˆ‡æ›ç•«é¢
            document.getElementById('settings-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';

            loadQuestion();
        }

        // è§£ææ‰‹å‹•è¼¸å…¥çš„é¡Œç›®
        function parseCustomQuestions(text) {
            const questions = [];
            const lines = text.toUpperCase().split('\n').filter(line => line.trim() !== '');

            for (const line of lines) {
                const parts = line.split('/');
                if (parts.length === 2 && parts[0].trim() && parts[1].trim()) {
                    questions.push({
                        word: parts[0].trim(),
                        hint: parts[1].trim()
                    });
                }
            }
            return questions;
        }

        // éš¨æ©Ÿæ’åºé™£åˆ— (Fisher-Yates æ¼”ç®—æ³•)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // è¼‰å…¥ä¸‹ä¸€é¡Œ
        function loadQuestion() {
            if (currentQuestionIndex >= currentQuestionList.length) {
                document.getElementById('question-display').innerHTML = "éŠæˆ²çµæŸï¼ğŸ‰";
                document.getElementById('message').innerHTML = `ç¸½åˆ†: ${score} / ${currentQuestionList.length}`;
                document.getElementById('answer-input').style.display = 'none';
                document.getElementById('submit-btn').style.display = 'none';
                return;
            }

            const question = currentQuestionList[currentQuestionIndex];
            document.getElementById('question-display').innerHTML = 
                `<strong>ç¬¬ ${currentQuestionIndex + 1} é¡Œ / å…± ${currentQuestionList.length} é¡Œ:</strong> ${question.hint}`;
            
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
            document.getElementById('message').innerHTML = '';
            document.getElementById('submit-btn').textContent = 'å®Œæˆ (Enter)';
            document.getElementById('score-board').textContent = `å¾—åˆ†: ${score}`;
            isAnswerChecked = false; // é‡è¨­ Enter éµç‹€æ…‹
            document.getElementById('answer-input').disabled = false;
        }

        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const userAnswer = document.getElementById('answer-input').value.toUpperCase().trim();
            const correctWord = currentQuestionList[currentQuestionIndex].word.toUpperCase().trim();
            const messageElement = document.getElementById('message');

            if (isAnswerChecked) {
                // å¦‚æœå·²ç¶“æª¢æŸ¥éç­”æ¡ˆï¼Œå‰‡è·³åˆ°ä¸‹ä¸€é¡Œ (é€™æ˜¯ç¬¬äºŒå€‹ Enter æˆ–ç¬¬äºŒæ¬¡é»æ“Š)
                currentQuestionIndex++;
                loadQuestion();
                return;
            }

            // ç¬¬ä¸€æ¬¡é»æ“Š/Enterï¼šæª¢æŸ¥ç­”æ¡ˆ
            isAnswerChecked = true; // é–å®šç‹€æ…‹
            document.getElementById('answer-input').disabled = true; // ç¦ç”¨è¼¸å…¥æ¡†

            if (userAnswer === correctWord) {
                score++;
                messageElement.className = 'correct';
                messageElement.innerHTML = `âœ… æ­£ç¢ºï¼ç­”æ¡ˆæ˜¯ <strong>${correctWord}</strong>ã€‚`;
            } else {
                messageElement.className = 'incorrect';
                messageElement.innerHTML = `âŒ éŒ¯èª¤ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯ <strong>${correctWord}</strong>ã€‚`;
            }

            document.getElementById('score-board').textContent = `å¾—åˆ†: ${score}`;
            document.getElementById('submit-btn').textContent = 'ä¸‹ä¸€é¡Œ (Enter)';
        }

        // ç›£è½ Enter éµ
        document.getElementById('answer-input').addEventListener('keypress', function(event) {
            // ç¢ºä¿åªæœ‰åœ¨éŠæˆ²ç•«é¢æ™‚æ‰è§¸ç™¼
            if (document.getElementById('game-screen').style.display === 'block' && event.key === 'Enter') {
                event.preventDefault(); // é˜²æ­¢é»˜èªçš„è¡¨å–®æäº¤è¡Œç‚º
                checkAnswer(); // è§¸ç™¼æª¢æŸ¥ç­”æ¡ˆ/é€²å…¥ä¸‹ä¸€é¡Œçš„é‚è¼¯
            }
        });

        // é‡è¨­éŠæˆ²
        function resetGame() {
            document.getElementById('settings-screen').style.display = 'block';
            document.getElementById('game-screen').style.display = 'none';
            // ç¢ºä¿éŠæˆ²ç•«é¢é‡ç½®
            document.getElementById('answer-input').style.display = 'block';
            document.getElementById('submit-btn').style.display = 'block';
        }

        // åˆå§‹è¼‰å…¥æ™‚è¨­å®šç‹€æ…‹
        resetGame();

    </script>
</body>
</html>
