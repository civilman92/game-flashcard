<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ–‡å–®å­—å¿«é–ƒå¡éŠæˆ²</title>
    <style>
        :root {
            --primary: #5C6BC0; --success: #66BB6A; --danger: #EF5350; --bg: #F5F7FA;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { background: white; border-radius: 25px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); max-width: 900px; width: 100%; padding: 40px; position: relative; }
        
        .header { 
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; 
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f4fd 100%); padding: 20px; border-radius: 20px; 
        }
        .progress-info { font-size: 18px; font-weight: bold; color: #333; }
        .score-board { 
            display: flex; gap: 10px; padding: 10px 20px; background: rgba(255,255,255,0.9); 
            border-radius: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .score-icon { 
            font-size: 28px; transition: all 0.3s; 
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .trophy { color: #f39c12; } /* ğŸ† */
        .skull { color: #e74c3c; } /* ğŸ’€ */
        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .panel { display: none; } .active { display: block; }
        
        .image-container { 
            width: 100%; height: 380px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            border-radius: 25px; margin-bottom: 25px; display: flex; align-items: center; 
            justify-content: center; overflow: hidden; border: 5px solid #e9ecef;
            position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .image-container img { max-width: 95%; max-height: 95%; object-fit: contain; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .image-placeholder { font-size: 72px; color: #adb5bd; text-align: center; animation: pulse 2s infinite; }
        .image-status { position: absolute; bottom: 15px; right: 15px; font-size: 13px; color: #666; background: rgba(255,255,255,0.95); padding: 4px 12px; border-radius: 15px; font-weight: 500; }
        @keyframes pulse { 0%, 100% { opacity: 0.7; transform: scale(1); } 50% { opacity: 1; transform: scale(1.05); } }

        .chinese-hint { 
            font-size: 44px; font-weight: 900; text-align: center; margin-bottom: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .letter-inputs { display: flex; justify-content: center; gap: 10px; margin: 30px 0; flex-wrap: wrap; }
        .letter-box { 
            width: 60px; height: 75px; border: 4px solid #dee2e6; border-radius: 15px; 
            text-align: center; font-size: 32px; font-weight: 900; text-transform: uppercase; 
            outline: none; transition: all 0.4s; background: white; cursor: text;
        }
        .letter-box:focus { 
            border-color: var(--primary); background: linear-gradient(135deg, #e8f0fe, #f0f4ff); 
            transform: scale(1.08); box-shadow: 0 0 0 4px rgba(92,107,192,0.25);
        }
        .letter-box.correct { 
            background: linear-gradient(135deg, var(--success), #4caf50); 
            color: white; border-color: var(--success); animation: correctBounce 0.7s; 
        }
        .letter-box.wrong { 
            background: linear-gradient(135deg, var(--danger), #d32f2f); 
            color: white; border-color: var(--danger); animation: wrongShake 0.6s; 
        }
        @keyframes correctBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-15px) scale(1.1); }
            60% { transform: translateY(-8px) scale(1.05); }
        }
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px) rotate(-2deg); }
            20%, 40%, 60%, 80% { transform: translateX(8px) rotate(2deg); }
        }

        .result-message {
            text-align: center; font-size: 28px; font-weight: bold; margin: 25px 0; 
            min-height: 40px; padding: 15px; border-radius: 20px;
        }
        .result-correct { background: linear-gradient(135deg, #d4edda, #c3e6cb); color: #155724; }
        .result-wrong { background: linear-gradient(135deg, #f8d7da, #f5c6cb); color: #721c24; }

        .btn { 
            padding: 16px 45px; border: none; border-radius: 35px; font-size: 20px; 
            cursor: pointer; font-weight: 700; transition: all 0.3s; 
            box-shadow: 0 6px 20px rgba(0,0,0,0.15); margin: 10px;
        }
        .btn-primary { background: linear-gradient(135deg, var(--primary), #3f51b5); color: white; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(92,107,192,0.4); }
        .btn-speaker { 
            background: linear-gradient(135deg, #fff176, #fdd835); color: #333; 
            font-size: 24px; box-shadow: 0 6px 20px rgba(255,235,59,0.4);
        }
        .btn-speaker:hover { transform: translateY(-3px); }

        .summary-table { width: 100%; border-collapse: collapse; margin-top: 25px; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .summary-table th, .summary-table td { padding: 20px; border-bottom: 1px solid #eee; text-align: left; }
        .summary-table th { background: linear-gradient(135deg, var(--primary), #3f51b5); color: white; font-weight: 700; }
        .status-correct { color: var(--success); font-weight: bold; }
        .status-wrong { color: var(--danger); font-weight: bold; }
        
        textarea { 
            width: 100%; height: 250px; padding: 25px; border-radius: 20px; 
            border: 4px solid #dee2e6; margin-bottom: 25px; font-size: 16px; 
            resize: vertical; transition: all 0.3s; line-height: 1.6;
        }
        textarea:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 5px rgba(92,107,192,0.15); }

        @media (max-width: 768px) {
            .letter-box { width: 50px; height: 65px; font-size: 26px; }
            .chinese-hint { font-size: 36px; }
            .score-board { gap: 8px; }
            .score-icon { font-size: 24px; }
        }
    </style>
</head>
<body>
<div class="container">
    <div id="setupPanel" class="panel active">
        <h2 style="text-align: center; margin-bottom: 20px; font-size: 32px;">ğŸ“š è‹±æ–‡å–®å­—å¿«é–ƒå¡éŠæˆ²</h2>
        <textarea id="wordInput" placeholder="æ ¼å¼ï¼šè‹±æ–‡|ä¸­æ–‡&#10;ä¾‹å¦‚ï¼šapple|è˜‹æœ">apple|è˜‹æœ
banana|é¦™è•‰
computer|é›»è…¦
elephant|å¤§è±¡
flower|èŠ±æœµ
guitar|å‰ä»–
happiness|å¿«æ¨‚
internet|ç¶²è·¯
jacket|å¤¾å…‹
kitchen|å»šæˆ¿
lemon|æª¸æª¬
mountain|å±±è„ˆ
notebook|ç­†è¨˜æœ¬
orange|æ©˜å­
pencil|é‰›ç­†
queen|çš‡å
rabbit|å…”å­
school|å­¸æ ¡
tiger|è€è™
umbrella|é›¨å‚˜</textarea>
        <button class="btn btn-primary" style="display: block; margin: 0 auto; font-size: 22px; padding: 18px 60px;" onclick="initGame()">ğŸš€ é–‹å§‹æŒ‘æˆ° 20 é¡Œ</button>
    </div>

    <div id="gamePanel" class="panel">
        <div class="header">
            <div class="progress-info">
                <div id="questionTitle" style="font-size: 26px; margin-bottom: 5px;">ç¬¬ 1 é¡Œ</div>
                <div>é€²åº¦: <span id="progressText">0/20</span></div>
            </div>
            <div class="score-board" id="scoreBoard">
                <!-- å‹•æ…‹ç”Ÿæˆçç›ƒ/éª·é¡±é ­ -->
            </div>
        </div>

        <div class="image-container" id="imageContainer">
            <img id="wordImage" src="" alt="å–®å­—åœ–ç‰‡" style="display: none;">
            <div id="imagePlaceholder" class="image-placeholder" style="display: none;">ğŸ“·</div>
            <div id="imageStatus" class="image-status"></div>
        </div>
        
        <div class="chinese-hint" id="chineseHint">è¼‰å…¥ä¸­...</div>
        
        <div style="text-align: center;">
            <button class="btn btn-speaker" onclick="pronounceWord()">ğŸ”Š è½ç™¼éŸ³</button>
        </div>

        <div class="letter-inputs" id="letterInputs"></div>
        
        <div class="result-message" id="resultMessage"></div>
    </div>

    <div id="resultPanel" class="panel">
        <h2 style="text-align: center; font-size: 36px; margin-bottom: 25px;">ğŸ† æŒ‘æˆ°å®Œæˆï¼</h2>
        <div style="max-height: 550px; overflow-y: auto; margin: 25px 0;">
            <table class="summary-table" id="summaryTable">
                <thead><tr><th>å–®å­—</th><th>æ­£ç¢ºç­”æ¡ˆ</th><th>æ‚¨çš„å›ç­”</th><th>ç‹€æ…‹</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <button class="btn btn-primary" style="display: block; margin: 0 auto; font-size: 22px; padding: 18px 60px;" onclick="location.reload()">ğŸ”„ é‡æ–°é–‹å§‹</button>
    </div>
</div>

<script>
    const defaultWords = document.getElementById('wordInput').value;
    let wordBank = [], gameList = [], currentIdx = 0, results = [], scores = [];
    let imageCache = new Map();
    let answerChecked = false;

    function loadWordImage(word) {
        const img = document.getElementById('wordImage');
        const container = document.getElementById('imageContainer');
        const placeholder = document.getElementById('imagePlaceholder');
        const status = document.getElementById('imageStatus');
        
        if (imageCache.has(word)) {
            img.src = imageCache.get(word);
            img.style.display = 'block';
            status.textContent = 'ğŸ’¾ å¿«å–';
            placeholder.style.display = 'none';
            return;
        }

        img.style.display = 'none';
        placeholder.style.display = 'block';
        placeholder.innerHTML = 'ğŸ” æœå°‹ä¸­...';
        status.textContent = 'æœå°‹ä¸­';

        const sources = [
            `https://source.unsplash.com/800x600/?${word}`,
            `https://picsum.photos/seed/${word}/800/600`,
            `https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop&${word}`
        ];

        let attempt = 0;
        function trySource() {
            if (attempt >= sources.length) {
                placeholder.innerHTML = `ğŸ“¸ ${word.toUpperCase()}`;
                status.textContent = 'æ™ºæ…§åœ–ç¤º';
                return;
            }
            img.src = sources[attempt++];
        }

        img.onload = () => {
            imageCache.set(word, img.src);
            placeholder.style.display = 'none';
            img.style.display = 'block';
            status.textContent = `âœ… åœ–ç‰‡è¼‰å…¥`;
        };

        img.onerror = () => {
            if (attempt < sources.length) setTimeout(trySource, 300);
        };

        trySource();
    }

    function initGame() {
        const raw = document.getElementById('wordInput').value.trim();
        wordBank = raw.split('\n').map(line => {
            const parts = line.split('|');
            return { en: parts[0]?.trim().toLowerCase(), ch: parts[1]?.trim() };
        }).filter(item => item.en && item.ch);

        if (wordBank.length < 20) { alert("è«‹è‡³å°‘è¼¸å…¥ 20 å€‹å–®å­—ï¼"); return; }

        gameList = [...wordBank].sort(() => Math.random() - 0.5).slice(0, 20);
        imageCache.clear(); scores = []; results = []; currentIdx = 0; answerChecked = false;
        
        document.getElementById('scoreBoard').innerHTML = '';
        document.getElementById('setupPanel').classList.remove('active');
        document.getElementById('gamePanel').classList.add('active');
        loadQuestion();
    }

    function loadQuestion() {
        const q = gameList[currentIdx];
        document.getElementById('questionTitle').textContent = `ç¬¬ ${currentIdx + 1} é¡Œ`;
        document.getElementById('progressText').textContent = `${currentIdx + 1}/20`;
        document.getElementById('chineseHint').textContent = q.ch;
        document.getElementById('resultMessage').textContent = '';
        document.getElementById('resultMessage').className = 'result-message';
        
        loadWordImage(q.en);
        setTimeout(pronounceWord, 1000);

        const container = document.getElementById('letterInputs');
        container.innerHTML = '';
        
        q.en.split('').forEach((char, i) => {
            if (char === ' ' || char === '-') {
                const s = document.createElement('span');
                s.textContent = char; s.style.width = '30px'; s.style.height = '75px'; s.style.lineHeight = '75px';
                container.appendChild(s);
            } else {
                const input = document.createElement('input');
                input.className = 'letter-box'; input.maxLength = 1; input.dataset.index = i;
                input.addEventListener('input', handleInput);
                input.addEventListener('keydown', handleKeydown);
                container.appendChild(input);
            }
        });
        
        answerChecked = false;
        setTimeout(() => container.querySelector('input')?.focus(), 1500);
    }

    function handleInput(e) {
        const input = e.target;
        let value = input.value.toLowerCase().replace(/[^a-z]/g, '');
        input.value = value ? value.toUpperCase() : '';
        
        if (input.value && parseInt(input.dataset.index) < gameList[currentIdx].en.length - 1) {
            const nextInput = document.querySelector(`.letter-box[data-index="${parseInt(input.dataset.index) + 1}"]`);
            if (nextInput) nextInput.focus();
        }
    }

    function handleKeydown(e) {
        const inputs = document.querySelectorAll('.letter-box');
        const currentIndex = parseInt(e.target.dataset.index);
        
        // Backspace/Delete é‚è¼¯
        if ((e.key === 'Backspace' || e.key === 'Delete') && !e.target.value) {
            if (currentIndex > 0) {
                const prevInput = document.querySelector(`.letter-box[data-index="${currentIndex - 1}"]`);
                if (prevInput) {
                    prevInput.focus();
                    prevInput.value = '';
                }
            }
            e.preventDefault();
        }
        
        // Enter éµé‚è¼¯ï¼šç¬¬ä¸€æ¬¡æª¢æŸ¥ç­”æ¡ˆï¼Œç¬¬äºŒæ¬¡ä¸‹ä¸€é¡Œ
        if (e.key === 'Enter') {
            e.preventDefault();
            if (!answerChecked) {
                checkAnswer();
            } else {
                goNext();
            }
        }
    }

    function checkAnswer() {
        const q = gameList[currentIdx];
        const inputs = document.querySelectorAll('.letter-box');
        let userAns = '', inputIdx = 0;
        
        q.en.split('').forEach(char => {
            if (char === ' ' || char === '-') userAns += char;
            else userAns += inputs[inputIdx++].value.toLowerCase();
        });

        const isCorrect = userAns === q.en;
        results.push({ q: q.en, ch: q.ch, user: userAns, status: isCorrect });
        scores.push(isCorrect ? 'ğŸ†' : 'ğŸ’€');

        // æ›´æ–°è¨ˆåˆ†æ¿
        updateScoreBoard();

        // è¦–è¦ºåé¥‹
        inputs.forEach((box, i) => {
            box.disabled = true;
            const userChar = box.value.toLowerCase();
            const correctChar = q.en[i];
            box.classList.add(userChar === correctChar ? 'correct' : 'wrong');
        });

        // é¡¯ç¤ºçµæœ
        const resultMsg = document.getElementById('resultMessage');
        if (isCorrect) {
            resultMsg.textContent = 'ğŸ‰ æ­£ç¢ºï¼æŒ‰ Enter é€²å…¥ä¸‹ä¸€é¡Œ';
            resultMsg.className = 'result-message result-correct';
        } else {
            resultMsg.textContent = `âŒ æ­£ç¢ºç­”æ¡ˆï¼š${q.en.toUpperCase()}ï¼ŒæŒ‰ Enter é€²å…¥ä¸‹ä¸€é¡Œ`;
            resultMsg.className = 'result-message result-wrong';
        }

        answerChecked = true;
    }

    function updateScoreBoard() {
        const board = document.getElementById('scoreBoard');
        board.innerHTML = scores.map((score, idx) => 
            `<span class="score-icon ${score === 'ğŸ†' ? 'trophy' : 'skull'}">${score}</span>`
        ).join('');
    }

    function pronounceWord() {
        const q = gameList[currentIdx];
        const msg = new SpeechSynthesisUtterance(q.en);
        msg.lang = 'en-US'; msg.rate = 0.7; msg.volume = 0.9;
        speechSynthesis.speak(msg);
    }

    function goNext() {
        currentIdx++;
        if (currentIdx < 20) {
            loadQuestion();
        } else {
            showFinalResults();
        }
    }

    function showFinalResults() {
        document.getElementById('gamePanel').classList.remove('active');
        document.getElementById('resultPanel').classList.add('active');
        const tbody = document.querySelector('#summaryTable tbody');
        tbody.innerHTML = '';
        results.forEach(r => {
            const row = tbody.insertRow();
            row.insertCell(0).textContent = r.q;
            row.insertCell(1).textContent = r.q;
            row.insertCell(2).textContent = r.user || '(æœªå¡«å¯«)';
            const sCell = row.insertCell(3);
            sCell.textContent = r.status ? 'âœ… æ­£ç¢º' : 'âŒ éŒ¯èª¤';
            sCell.className = r.status ? 'status-correct' : 'status-wrong';
        });
    }
</script>
</body>
</html>
